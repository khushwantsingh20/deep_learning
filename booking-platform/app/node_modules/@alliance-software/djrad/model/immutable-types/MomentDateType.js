import { Typed } from 'typed-immutable';
import TypedField from 'alliance-redux-api/lib/Field';
import moment from 'moment';

const DATE_FORMAT = 'YYYY-MM-DD';

export default function MomentDateType(defaultValue) {
    const TypedDate = Typed('MomentDate', value => {
        const date = moment(value, DATE_FORMAT, true);
        if (!date.isValid()) {
            return TypeError(`Not a valid date: ${value}`);
        }
        return date;
    });

    const serializeDate = value => (moment.isMoment(value) ? value.format(DATE_FORMAT) : value);
    return TypedField(TypedDate(defaultValue), serializeDate);
}
