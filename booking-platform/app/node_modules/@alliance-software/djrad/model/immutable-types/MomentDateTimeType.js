import { Typed } from 'typed-immutable';
import TypedField from 'alliance-redux-api/lib/Field';
import moment from 'moment';

export default function MomentDateTimeType(defaultValue) {
    const TypedDateTime = Typed('MomentDateTime', value => {
        const date = moment(value, moment.ISO_8601);
        if (!date.isValid()) {
            return TypeError(`Not a valid date: ${value}`);
        }
        return date;
    });

    const serializeDateTime = value => (moment.isMoment(value) ? value.format() : value);
    return TypedField(TypedDateTime(defaultValue), serializeDateTime);
}
