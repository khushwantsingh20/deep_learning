"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = ForeignKeyField;
exports.$foreignKey = void 0;

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

var _invariant = _interopRequireDefault(require("invariant"));

var _typedImmutable = require("typed-immutable");

var _Field = require("./Field");

var _Model = require("./Model");

var $foreignKey = Symbol["for"]('alliance-redux-api/isForeignKey');
exports.$foreignKey = $foreignKey;

function ForeignKeyField(target) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  (0, _invariant["default"])((0, _Model.isModel)(target), 'Foreign key must be passed a ModelRecord');

  var parse = function parse(value) {
    if ((0, _Model.isModel)(value)) {
      return value.getId();
    }

    return value;
  };

  var field = (0, _typedImmutable.Typed)('ForeignKey', parse);
  field[_Field.$parse] = parse;
  field.prototype[$foreignKey] = (0, _objectSpread2["default"])({}, options, {
    target: target
  });
  return field;
}